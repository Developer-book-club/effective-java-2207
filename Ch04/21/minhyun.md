# 디폴트메서드

디폴트 메서드 선언시, **인터페이스를 구현한 후 디폴트 메서드를 재정의 하지 않은 모든 클래스에서 디폴트 구현이 쓰인다.**

대신 생각할 수 있는 모든 상황에서 **불변식을 해치지 않는 디폴트 메서드를 작성하기는 어렵다.**

자바 8 이후에 default 메서드가 추가되면서 기존 구현체를 깨뜨리지 않고 인터페이스에 메서드를 추가할 수 있게 되었지만 위험이 아예 없진 않다.

→ 자바 7까지의 세상에서는 모든 클래스가 ‘현재 인터페이스에 새로운 메서드가 추가될 일은 영원히 없다' 라고 가정하고 작성 됐기 때문

## 예시

![image-20220813231912602](https://tva1.sinaimg.cn/large/e6c9d24egy1h55i2engzpj20h007g74l.jpg)

범용적으로 잘 구현했지만, 현존하는 모든 Collection 구현체와 잘 어우러지는것은 아니다.

→ SynchronizedCollection

### SynchronizedCollection

아파치 커먼즈 라이브러리의 클래스인데, 해당 클래스는 모든 메서드에서 주어진 락 객체로 동기화한 후 내부 컬렉션 객체에 기능을 위임하는 래퍼클래스다.

해당 클래스는 활발히 관리되고 있지만 아직까지 `removeIf` 메서드를 재정의 하지 않고 있다.

→ removeIf의 디폴트 구현을 물려받으면 모든 메서드 호출을 알아서 동기화하지 못한다.

### 자바 플랫폼 라이브러리의 예방

위 Synchronized Collection의 문제를 예방하기 위해 구현한 인터페이스의 디폴트 메서드를 재정의하고, 다른 메서드에서는 디폴트 메서드를 호출하기 전에 필요한 작업을 수행하도록 했다.

(ex) `Collections.synchronizedCollection`이 반환하는 package-private 클래스들은 removeIf를 재정의하고, 이를 호출하는 다른 메서드들은 디폴트 구현을 호출하기 전 동기화를 하도록 처리했다.

→ 대신 제 3자의 기존 컬렉션 구현체들은 해당 변경에 발맞춰 수정될 기회가 없고 현재도 수정되지 않은 부분이 많다.

## 정리

- (컴파일에 성공하더라도) 기존 구현체에 런타임 오류를 일으킬 수 있다.
- 기존 인터페이스에 디폴트 메서드로 새 메서드를 추가하는 일은 꼭 필요한 경우가 아니면 피해야 한다.
  - 새로운 인터페이스를 만드는 경우라면 표준 메서드 구현을 제공하는데 아주 유용한 수단이다.
- 디폴트 메서드는 인터페이스로부터 메서드를 제거하거나 기존 메서드의 시그니처를 수정하는 용도가 아니다.
- 인터페이스를 설계할 때 세심한 주의를 기울이자.
  - 사이드 이펙트가 발생할 수 있다.
- 새로운 인터페이스는 릴리스 전에 반드시 테스트를 거치자.
  - 릴리스 전에는 바로잡을 기회가 있지만 이후에는 기회가 없을 수 있다는 것을 명심하자.
