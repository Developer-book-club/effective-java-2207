호출된 메서드가 실패하더라도 해당 객체는 메서드 호출 전 상태를 유지해야 한다. → 실패 원자적

# 방법

## 1. 불변 객체로 설계

불변 객체는 태생적으로 실패 원자적이다. 생성 시점에 고정되어 절대 변하지 않기 때문이다.

## 2. 가변객체일 경우 수행전 매개변수 검사

작업 수행 전 매개변수의 유효성을 검사하는 것이다.

```java
...
if (size == 0)
	throw new EmptyStackException();
...
```

### 실패할 가능성이 있는 모든 코드를 상태를 바꾸는 코드보다 앞에 배치

계산을 수행하기 전에는 인수의 유효성을 검사해볼 수 없을 때 2번 방식에 덧붙여 쓸수있는 기법이다.

(ex) TreeMap

엉뚱한 타입의 원소를 추가하려 하면 트리를 변경하기 전 해당 원소가 들어갈 위치를 찾는 과정에서 ClassCastException을 던질 것이다.

## 3. 객체의 임시 복사본에서 작업을 수행

임시 복사본에서 작업을 수행하고, 성공적으로 작업이 끝나면 원래 객체와 교체하는 것이다.

(ex) 어떤 정렬 메서드에서는 정렬을 수행하기 전 입력 리스트의 원소들을 배열로 옮겨 담고, 정렬이 완료되면 다시 list로 만든다.

## 4. 실패를 가로채는 복구 코드를 작성

주로 디스크 기반의 내구성을 보장해야하는 자료구조에 쓰인다.

# 그래서

- 실패 원자적으로 만들 수 있어도 꼭 그렇게 할 필요는 없다.
  - 실패 원자성을 달성하기 윟나 비용이나 복잡도가 아주 큰 연산도 있기 떄문이.
- 하지만 어쨌든 메서드 명세에 기술한 예외면 예외가 발생해도 객체의 상태는 메서드 호출 전과 똑같이 유지되어야 한다는 것이 기본 규칙이다.
